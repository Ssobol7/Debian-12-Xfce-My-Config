# Оптимизация работы SSD в Debian 12

![ssd](https://github.com/user-attachments/assets/cd3593b4-af71-4081-b11d-8173085cc17a)

&nbsp;

## Настройка `/etc/fstab`

> **`fstab`** — это важный конфигурационный файл операционной системы, который используется при загрузке. В нем описано, какие разделы и устройства файловой системы должны быть смонтированы и каким образом.

Открываем файл **`fstab`**:

```bash
$ sudo vi /etc/fstab
```

### Отключение файла подкачки (swap)

Если вы установили SSD, имеет смысл увеличить объем оперативной памяти и отключить файл подкачки (swap), чтобы уменьшить количество записей на диск и увеличить скорость работы системы. Для комфортной работы обычно достаточно 4 ГБ оперативной памяти, однако рекомендуется оценить потребление памяти в вашей системе с помощью утилит `free` и `top`.

Если памяти достаточно, можно установить систему без раздела подкачки или отключить его в уже установленной системе. Для этого закомментируйте строку со swap в файле `/etc/fstab`, добавив символ `#` в начале строки:

```bash
#UUID=xxxx-xxxx-xxxx-xxxx      none    swap    sw      0       0
```

Если же объем оперативной памяти недостаточен для ваших задач, рекомендуется настроить приоритет использования swap (см. ниже).

### Опции монтирования для SSD

В файле `/etc/fstab` убедитесь, что раздел с корневой файловой системой смонтирован с оптимальными для SSD опциями. Например:

```bash
UUID=aeade6fd-2b24-4e59-bc8c-6f1791338b0c / ext4 noatime,errors=remount-ro 0 1
```

Где:

- **noatime** — предотвращает обновление времени последнего доступа к файлам при их чтении, что уменьшает количество записей на диск.
  
- **errors=remount-ro** — в случае ошибок файловой системы переводит раздел в режим только для чтения, что позволяет избежать потери данных.

#### Включение TRIM для SSD

Команда TRIM позволяет операционной системе информировать SSD о блоках данных, которые больше не используются и могут быть удалены, что помогает поддерживать производительность SSD со временем.

Рекомендуется настроить периодическое выполнение команды `fstrim`, вместо использования опции `discard` в `/etc/fstab`, которая выполняет TRIM при каждом удалении файла и может привести к снижению производительности на некоторых SSD.

**Настройка периодического TRIM с помощью systemd:**

```bash
$ sudo systemctl enable fstrim.timer
$ sudo systemctl start fstrim.timer
```

Это настроит автоматический запуск `fstrim` еженедельно.

### Перенос кэша APT в оперативную память

Вы можете уменьшить количество записей на диск, переместив кэш пакетов APT в оперативную память. Добавьте в `/etc/fstab` следующую строку:

```bash
tmpfs   /var/cache/apt/archives   tmpfs   defaults   0   0
```

**Важно:** В этом случае кэш пакетов не будет сохраняться между перезагрузками, и при переустановке пакетов они будут загружаться заново, что может увеличить трафик и время установки пакетов.

### Отключение дискового кэша в браузерах

Чтобы уменьшить количество записей на SSD, можно отключить дисковый кэш в веб-браузерах:

1. **Mozilla Firefox**

   - Откройте настройки: **Меню** → **Настройки** → **Приватность и защита**.
   - Прокрутите вниз до раздела **Куки и данные сайтов**.
   - Нажмите **Управление данными...** и удалите существующие данные, если необходимо.
   - Для полного отключения кэша можно использовать настройку в `about:config`:
     - В адресной строке введите `about:config` и нажмите Enter.
     - Примите предупреждение о рисках.
     - В строке поиска введите `browser.cache.disk.enable`.
     - Дважды щелкните по параметру, чтобы установить значение `false`.

2. **Google Chrome/Chromium**

   - В графическом интерфейсе опции для полного отключения дискового кэша нет.
   - Вы можете запускать браузер с параметром командной строки:
     ```bash
     $ google-chrome --disk-cache-size=0
     ```
   - Или изменить параметры запуска в ярлыке приложения.

3. **Opera**

   - Откройте настройки: **Меню** → **Настройки** → **Дополнительно** → **Браузер**.
   - В разделе **Система** можно настроить использование кэша, но полного отключения может не быть.

### Настройка `/etc/sysctl.conf`

Открываем файл **`/etc/sysctl.conf`** для настройки параметров ядра:

```bash
$ sudo vi /etc/sysctl.conf
```

#### Настройка приоритета использования swap

Чтобы уменьшить частоту обращения к swap при недостатке памяти, можно настроить параметр `vm.swappiness`. Добавьте в файл:

```bash
vm.swappiness=10
```

Значение `vm.swappiness` определяет, насколько активно система будет использовать swap. Значение по умолчанию обычно 60. Уменьшение этого значения до 10 заставит систему реже использовать swap, что особенно полезно для SSD, чтобы уменьшить износ.

#### Настройка отложенной записи

Вы можете настроить параметры отложенной записи, чтобы уменьшить частоту записей на диск:

```bash
vm.dirty_ratio = 15
vm.dirty_background_ratio = 5
```

- **vm.dirty_ratio** — максимальный процент памяти, который может быть занят грязными страницами (данными, ожидающими записи на диск) перед тем, как процесс записи будет форсирован для очистки.
  
- **vm.dirty_background_ratio** — процент памяти, при котором фоновый процесс записи начнет сбрасывать данные на диск.

Эти настройки позволяют системе накапливать больше данных в памяти перед записью на диск, что уменьшает количество операций записи.

### Применение изменений

Чтобы применить новые настройки, выполните:

```bash
$ sudo sysctl -p
```

Или перезагрузите систему:

```bash
$ sudo reboot
```

---

## Дополнительные рекомендации

- **Обновление прошивки SSD:** Убедитесь, что на вашем SSD установлена последняя версия прошивки от производителя, которая может содержать улучшения в производительности и надежности.

- **Мониторинг состояния SSD:** Используйте утилиты, такие как `smartctl`, для проверки состояния SSD и мониторинга показателей SMART.

- **Выравнивание разделов:** При разметке диска убедитесь, что разделы выровнены по границам блоков SSD, что может улучшить производительность.

- **Файловая система:** Используйте современные файловые системы, такие как `ext4` или `btrfs`, которые имеют оптимизации для работы с SSD.

- **Резервное копирование:** Регулярно делайте резервные копии важных данных, так как SSD, как и любые носители, могут выйти из строя.

## Заключение

Следуя данным рекомендациям, вы сможете оптимизировать работу вашего SSD в системе Debian, увеличить его производительность и продлить срок службы. Однако помните, что современные операционные системы и SSD часто уже оптимизированы для совместной работы, поэтому не все перечисленные настройки могут быть необходимы в вашей ситуации. Всегда тщательно изучайте влияние изменений перед их применением.

---
