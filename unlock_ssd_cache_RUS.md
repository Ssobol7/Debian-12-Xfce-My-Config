Настройка поддержки SSD в Debian


Настройка /etc/fstab

/etc/fstab – один из важных файлов ОС, который исполняется во время загрузки системы. В нем описаны какие разделы накопителей и как именно монтируется в файловую систему ОС. Открываем:

gksu gedit /etc/fstab



Отключаем swap

Если уж SSD приобретен, то вполне можно добавить памяти в машину и отключить swap. Для этого будет достаточно уже 4GiB (используйте утилиты free и top, чтобы узнать сколько памяти потребляет ОС) Если памяти достаточно, ставим систему без свопа или отключаем его, если система уже установлена.
Комментируем (#) строку со словом swap

#UUID=xxxx-xxxx-xxxx-xxxx      none    swap    sw      0       0




Если же памяти для задач ОС маловато, то пробуем настроить приоритет использования swap (см ниже)

Опции монтирования

UUID=aeade6fd-2b24-4e59-bc8c-6f1791338b0c / ext4 noatime,discard,errors=remount-ro,commit=60 0 1



    discard - Включает технологию TRIM, которая распределяет нагрузку на SSD

    noatime и nodiratime - Благодаря этим опциям ОС не будет записывать время последнего обращения к файлам и папкам

    commit=60 - частота обращения к диску

При установке commit=60, возможна потеря данных за последние 60 сек. работы при внезапном выключении питания.

Помещаем в ОЗУ кэш apt

tmpfs   /var/cache/apt/archives tmpfs   defaults        0       0




Кэш apt не будет сохраняться на диске и при переустановке пакетов, потребуется их выкачивать заново.

Отключение дискового кэша в браузерах


    Mozilla Firefox
    Правка → Настройки → Дополнительные → Сеть → Поставить галочку «Отключить автоматическое управление кэшем» → Установить значение в 0.

    Opera
    Ctrl+F12 → Расширенные → История → Дисковый кэш → Отключено

    Chromium/Chrome
    К сожалению этот браузер не умеет отключать дисковый кэш из GUI. Есть различные способы всё-таки отключить дисковый кэш, разной степени корявости, не стану их тут описывать.



Настройка /etc/sysctl.conf

Открываем /etc/sysctl.conf:

sudo gedit /etc/sysctl.conf




Приоритет использования swap

Если памяти маловато, то можно просто уменьшить агрессивность свопинга. В /etc/sysctl.conf добавляем строчку

vm.swappiness=10




Параметр управляет процентным соотношением свободной памяти при котором начнётся свопинг.
Хотя, если у вас мало ОЗУ и вы купили себе SSD, то вы поступили не верно.

Отложенная запись

Ядро будет копить данные, ожидающие записи на диск, и записывать их либо при острой необходимости, либо по истечении таймаута. Я выбрал для себя 60 секунд.

Добавляем в конец файла:

vm.laptop_mode = 5
vm.dirty_writeback_centisecs = 6000




Для применения изменений

sudo sysctl -p




или перезагрузите ОС.

Проверка поддержки TRIM

sudo hdparm -I /dev/sdX | grep "TRIM supported"




sdX - ваш SSD.

Ручное выполнение TRIM

Вполне возможна ситуация когда по какой-то причине опции автоматического TRIM могут быть не включены, тогда понадобиться выполнить TRIM вручную. Обычно есть смысл провести эту операцию после активации TRIM с помощью опции монтирования discard в /etc/fsbab. Для этого существует небольшая утилита fstrim.

sudo fstrim / -v




Опция -v покажет в выводе команды сколько байт на разделе было «оттримлено»:

/: 28166164480 bytes were trimmed




Операция занимает некоторое время и может длиться от нескольких секунд до нескольких минут.
Проверена корректная работа утилиты на разделах ext4, btrfs. На ntfs и reiserfs не работает.

Настройки EXT4

Если у вас ноутбук или ИБП можно безбоязненно отключить журналирование, что не только уменьшит запись на SSD, но также повысит производительность.
Если вы работаете от сети, следует несколько раз подумать прежде чем отключать журнал, не так много он пишет, чтобы так рисковать.Возможно отключение журнала ломает TRIM. Кто знает точно, напишите в топике на форуме.
Загружаемся в live и:

sudo tune2fs -O ^has_journal /dev/sdXY




sudo e2fsck -f /dev/sdXY




где:


    Х - буква диска

    Y - номер раздела